<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Quiz Educacional</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div id="app"></div>
    <script>
        // Dados iniciais
        let usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
        let questoes = JSON.parse(localStorage.getItem('questoes') || '[{"id":1,"materia":"História","pergunta":"Qual evento iniciou a Primeira Guerra Mundial?","opcoes":{"a":"Assassinato do Arquiduque","b":"Invasão da Polônia","c":"Ataque a Pearl Harbor","d":"Revolução Russa"},"correta":"a","explicacao":"O assassinato foi o estopim."},{"id":2,"materia":"Geografia","pergunta":"Maior país da América do Sul?","opcoes":{"a":"Argentina","b":"Peru","c":"Brasil","d":"Colômbia"},"correta":"c","explicacao":"Brasil é o maior."}]');
        let historico = JSON.parse(localStorage.getItem('historico') || '[]');
        let usuarioLogado = null;
        let tela = 'cadastro';

        // Salvar dados
        function salvar() {
            localStorage.setItem('usuarios', JSON.stringify(usuarios));
            localStorage.setItem('questoes', JSON.stringify(questoes));
            localStorage.setItem('historico', JSON.stringify(historico));
        }

        // Renderizar
        function render() {
            const app = document.getElementById('app');
            app.innerHTML = '';
            
            if (tela === 'cadastro') {
                app.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center p-4">
                        <div class="bg-white p-8 rounded-lg shadow-lg max-w-md w-full">
                            <h1 class="text-3xl font-bold text-center mb-6">Cadastro</h1>
                            <select id="perfil" class="w-full p-3 border rounded mb-4">
                                <option value="aluno">Aluno</option>
                                <option value="professor">Professor</option>
                            </select>
                            <input type="text" id="nome" placeholder="Nome completo" class="w-full p-3 border rounded mb-4">
                            <input type="text" id="usuario" placeholder="Usuário" class="w-full p-3 border rounded mb-4">
                            <input type="text" id="professor" placeholder="Professor Responsável" class="w-full p-3 border rounded mb-4 bg-blue-50">
                            <input type="password" id="senha" placeholder="Senha" class="w-full p-3 border rounded mb-4">
                            <input type="password" id="senha2" placeholder="Confirmar senha" class="w-full p-3 border rounded mb-4">
                            <button onclick="cadastrar()" class="w-full bg-blue-500 text-white p-3 rounded font-semibold hover:bg-blue-600">Criar Conta</button>
                            <button onclick="tela='login';render()" class="w-full text-blue-500 mt-4">Fazer Login</button>
                        </div>
                    </div>
                `;
            } else if (tela === 'login') {
                app.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center p-4">
                        <div class="bg-white p-8 rounded-lg shadow-lg max-w-md w-full">
                            <h1 class="text-3xl font-bold text-center mb-6">Login</h1>
                            <input type="text" id="usuario" placeholder="Usuário" class="w-full p-3 border rounded mb-4">
                            <input type="password" id="senha" placeholder="Senha" class="w-full p-3 border rounded mb-4">
                            <button onclick="login()" class="w-full bg-blue-500 text-white p-3 rounded font-semibold hover:bg-blue-600">Entrar</button>
                            <button onclick="tela='cadastro';render()" class="w-full text-blue-500 mt-4">Criar Conta</button>
                        </div>
                    </div>
                `;
            } else if (tela === 'menu') {
                const materias = [...new Set(questoes.map(q => q.materia))];
                app.innerHTML = `
                    <div class="min-h-screen p-4">
                        <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6 p-4 bg-blue-50 rounded">
                                <div>
                                    <h2 class="text-lg font-semibold">${usuarioLogado.nome}</h2>
                                    <p class="text-sm">@${usuarioLogado.usuario}</p>
                                </div>
                                <button onclick="sair()" class="px-4 py-2 text-red-600 border border-red-600 rounded">Sair</button>
                            </div>
                            <h1 class="text-3xl font-bold text-center mb-8">Quiz Estudos</h1>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                <button onclick="tela='selecionar';render()" class="bg-blue-500 text-white p-6 rounded-lg hover:bg-blue-600">
                                    <h3 class="font-semibold">Fazer Quiz</h3>
                                </button>
                                ${usuarioLogado.perfil === 'professor' ? `
                                <button onclick="tela='inserir';render()" class="bg-green-500 text-white p-6 rounded-lg hover:bg-green-600">
                                    <h3 class="font-semibold">Inserir Questão</h3>
                                </button>` : ''}
                                <button onclick="tela='historico';render()" class="bg-purple-500 text-white p-6 rounded-lg hover:bg-purple-600">
                                    <h3 class="font-semibold">Histórico</h3>
                                </button>
                                <button onclick="gerarDOC()" class="bg-orange-500 text-white p-6 rounded-lg hover:bg-orange-600">
                                    <h3 class="font-semibold">Gerar DOC</h3>
                                </button>
                                <button onclick="gerarCSV()" class="bg-teal-500 text-white p-6 rounded-lg hover:bg-teal-600">
                                    <h3 class="font-semibold">Gerar Excel</h3>
                                </button>
                            </div>
                            <div class="mt-6 p-4 bg-gray-50 rounded text-center">
                                <p class="text-sm">Total: ${questoes.length} questões | Matérias: ${materias.join(', ')}</p>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function cadastrar() {
            const nome = document.getElementById('nome').value;
            const usuario = document.getElementById('usuario').value;
            const senha = document.getElementById('senha').value;
            const senha2 = document.getElementById('senha2').value;
            const perfil = document.getElementById('perfil').value;
            const professor = document.getElementById('professor').value;

            if (!nome || !usuario || !senha || !senha2) {
                alert('Preencha todos os campos!');
                return;
            }
            if (perfil === 'aluno' && !professor) {
                alert('Informe o professor responsável!');
                return;
            }
            if (senha !== senha2) {
                alert('Senhas diferentes!');
                return;
            }

            usuarios.push({id: Date.now(), nome, usuario, senha, perfil, professor});
            salvar();
            alert('Cadastro realizado!');
            tela = 'login';
            render();
        }

        function login() {
            const usuario = document.getElementById('usuario').value;
            const senha = document.getElementById('senha').value;
            const user = usuarios.find(u => u.usuario === usuario && u.senha === senha);
            
            if (user) {
                usuarioLogado = user;
                tela = 'menu';
                render();
            } else {
                alert('Usuário ou senha incorretos!');
            }
        }

        function sair() {
            usuarioLogado = null;
            tela = 'cadastro';
            render();
        }

        function gerarDOC() {
            const ultimo = historico.find(h => h.login === usuarioLogado.usuario);
            if (!ultimo) {
                alert('Faça um quiz primeiro!');
                return;
            }
            let html = '<html><head><meta charset="utf-8"><title>Relatorio</title></head><body style="font-family:Arial;margin:40px;">';
            html += '<h1 style="text-align:center;">RELATÓRIO QUIZ</h1>';
            html += '<p><strong>Nome:</strong> ' + ultimo.usuario + '</p>';
            html += '<p><strong>Professor:</strong> ' + ultimo.professor + '</p>';
            html += '<p><strong>Data:</strong> ' + ultimo.data + '</p>';
            html += '<p><strong>Percentual:</strong> ' + ultimo.perc + '%</p>';
            html += '</body></html>';
            
            const blob = new Blob([html], {type: 'application/msword'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Relatorio.doc';
            a.click();
            alert('DOC gerado!');
        }

        function gerarCSV() {
            if (historico.length === 0) {
                alert('Sem histórico!');
                return;
            }
            let csv = 'Data,Nome,Usuario,Perfil,Professor,Materia,Total,Acertos,Percentual\n';
            historico.forEach(h => {
                csv += `"${h.data}","${h.usuario}","${h.login}","${h.perfil}","${h.professor}","${h.materia}",${h.total},${h.acertos},${h.perc}\n`;
            });
            const blob = new Blob([csv], {type: 'text/csv'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'historico.csv';
            a.click();
            alert('Planilha gerada!');
        }

        // Iniciar
        render();
    </script>
</body>
</html>
